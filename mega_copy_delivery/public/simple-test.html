<!DOCTYPE html>
<html>
<head>
    <title>Mega Copy - Simple Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #2563eb;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .product {
            background: #f9fafb;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üõçÔ∏è Mega Copy - Simple Test Page</h1>
    
    <div class="card">
        <h2>API Status</h2>
        <div id="status">Click "Test API" to check connection...</div>
    </div>

    <div class="card">
        <h2>Actions</h2>
        <button onclick="testAPI()">Test API</button>
        <button onclick="addProduct()">Add Sample Product</button>
        <button onclick="window.location.href='http://localhost:3007'">Go to Main Page</button>
    </div>

    <div class="card">
        <h2>Products</h2>
        <div id="products">No products loaded yet...</div>
    </div>

    <script>
        const SUPABASE_URL = 'https://nzmscqfrmxqcukhshsok.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56bXNjcWZybXhxY3VraHNoc29rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyMTg1NDMsImV4cCI6MjA3MTc5NDU0M30.o0zQtPEjsuJnfQnY2MiakuM2EvTlVuRO9yeoajrwiLU';

        async function testAPI() {
            const statusEl = document.getElementById('status');
            const productsEl = document.getElementById('products');
            
            statusEl.innerHTML = 'Testing...';
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/rpc/get_products`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        limit_count: 10,
                        offset_count: 0,
                        search_query: '',
                        category_filter: ''
                    })
                });

                const result = await response.json();
                console.log('API Response:', result);

                if (response.ok) {
                    statusEl.innerHTML = '<span class="success">‚úÖ API Connected Successfully!</span>';
                    
                    // Handle different response formats
                    let products = [];
                    if (result && result.data) {
                        products = result.data;
                    } else if (Array.isArray(result)) {
                        products = result;
                    }
                    
                    if (products.length === 0) {
                        productsEl.innerHTML = '<p>No products found. Click "Add Sample Product" to create one.</p>';
                    } else {
                        let html = '';
                        products.forEach(p => {
                            html += `
                                <div class="product">
                                    <strong>${p.name || 'Unnamed'}</strong> - 
                                    ${p.price || 0}Ïõê 
                                    (Stock: ${p.stock || 0})
                                </div>
                            `;
                        });
                        productsEl.innerHTML = html;
                    }
                } else {
                    statusEl.innerHTML = `<span class="error">‚ùå API Error: ${result.message || 'Unknown error'}</span>`;
                    console.error('API Error:', result);
                }
            } catch (error) {
                statusEl.innerHTML = `<span class="error">‚ùå Connection Failed: ${error.message}</span>`;
                console.error('Error:', error);
            }
        }

        async function addProduct() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/rpc/add_product`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        product_name: 'Sample Product ' + new Date().toLocaleTimeString(),
                        product_price: Math.floor(Math.random() * 50000) + 10000,
                        product_description: 'This is a test product',
                        product_category: 'Test',
                        product_image_url: '',
                        product_stock: Math.floor(Math.random() * 100) + 1
                    })
                });

                if (response.ok) {
                    alert('Product added successfully!');
                    testAPI(); // Reload products
                } else {
                    const error = await response.json();
                    alert('Failed to add product: ' + (error.message || 'Unknown error'));
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Auto-test on load
        window.onload = () => {
            testAPI();
        };
    </script>
</body>
</html>