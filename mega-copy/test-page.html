<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mega Copy - ì§„ë‹¨ í˜ì´ì§€</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Mega Copy ì§„ë‹¨ í˜ì´ì§€</h1>
    
    <div class="card">
        <h2>1. ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testServers()">ì„œë²„ í…ŒìŠ¤íŠ¸</button>
        <div id="server-status"></div>
    </div>

    <div class="card">
        <h2>2. Supabase API í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testSupabase()">API í…ŒìŠ¤íŠ¸</button>
        <button onclick="testRPCFunctions()">RPC Functions í…ŒìŠ¤íŠ¸</button>
        <div id="api-status"></div>
    </div>

    <div class="card">
        <h2>3. ìƒí’ˆ ëª©ë¡ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="loadProducts()">ìƒí’ˆ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <div id="products-list"></div>
    </div>

    <div class="card">
        <h2>4. ì‹¤ì‹œê°„ ë¡œê·¸</h2>
        <div class="log" id="log"></div>
    </div>

    <script>
        const SUPABASE_URL = 'https://nzmscqfrmxqcukhshsok.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56bXNjcWZybXhxY3VraHNoc29rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyMTg1NDMsImV4cCI6MjA3MTc5NDU0M30.o0zQtPEjsuJnfQnY2MiakuM2EvTlVuRO9yeoajrwiLU';
        
        function log(message, type = 'info') {
            const logEl = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const color = {
                info: '#58a6ff',
                success: '#56d364',
                error: '#f85149',
                warning: '#d29922'
            }[type] || '#8b949e';
            
            logEl.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        async function testServers() {
            const statusEl = document.getElementById('server-status');
            statusEl.innerHTML = '<p>í…ŒìŠ¤íŠ¸ ì¤‘...</p>';
            
            const servers = [
                { name: 'localhost:3004', url: 'http://localhost:3004' },
                { name: 'localhost:3007', url: 'http://localhost:3007' },
                { name: 'Cloudflare Pages', url: 'https://mega-copy3.pages.dev' }
            ];
            
            let html = '';
            for (const server of servers) {
                try {
                    log(`${server.name} ì—°ê²° ì‹œë„...`, 'info');
                    const response = await fetch(server.url, { 
                        mode: 'no-cors',
                        signal: AbortSignal.timeout(3000)
                    });
                    html += `<p>${server.name}: <span class="status success">ì—°ê²°ë¨</span></p>`;
                    log(`${server.name} ì—°ê²° ì„±ê³µ`, 'success');
                } catch (error) {
                    html += `<p>${server.name}: <span class="status error">ì—°ê²° ì‹¤íŒ¨</span></p>`;
                    log(`${server.name} ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
                }
            }
            
            statusEl.innerHTML = html;
        }

        async function testSupabase() {
            const statusEl = document.getElementById('api-status');
            statusEl.innerHTML = '<p>Supabase ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...</p>';
            
            try {
                log('Supabase API ì—°ê²° ì‹œë„...', 'info');
                const response = await fetch(`${SUPABASE_URL}/rest/v1/`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                    }
                });
                
                if (response.ok) {
                    statusEl.innerHTML = '<p>Supabase: <span class="status success">ì—°ê²° ì„±ê³µ</span></p>';
                    log('Supabase ì—°ê²° ì„±ê³µ!', 'success');
                } else {
                    statusEl.innerHTML = `<p>Supabase: <span class="status error">ì˜¤ë¥˜ ${response.status}</span></p>`;
                    log(`Supabase ì˜¤ë¥˜: ${response.status}`, 'error');
                }
            } catch (error) {
                statusEl.innerHTML = `<p>Supabase: <span class="status error">ì—°ê²° ì‹¤íŒ¨</span></p>`;
                log(`Supabase ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        async function testRPCFunctions() {
            const statusEl = document.getElementById('api-status');
            statusEl.innerHTML = '<p>RPC Functions í…ŒìŠ¤íŠ¸ ì¤‘...</p>';
            
            try {
                log('RPC get_products í•¨ìˆ˜ í˜¸ì¶œ...', 'info');
                const response = await fetch(`${SUPABASE_URL}/rest/v1/rpc/get_products`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        limit_count: 5,
                        offset_count: 0
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    statusEl.innerHTML = `
                        <p>RPC Functions: <span class="status success">ì‘ë™ ì¤‘</span></p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                    log('RPC Functions ì •ìƒ ì‘ë™!', 'success');
                } else {
                    statusEl.innerHTML = `
                        <p>RPC Functions: <span class="status error">ì˜¤ë¥˜</span></p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                    log(`RPC ì˜¤ë¥˜: ${data.message || 'Unknown error'}`, 'error');
                    
                    if (data.message && data.message.includes('does not exist')) {
                        statusEl.innerHTML += `
                            <div class="status warning" style="margin-top: 10px; padding: 10px;">
                                âš ï¸ SQL Functionsê°€ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!<br>
                                1. <a href="https://supabase.com/dashboard/project/nzmscqfrmxqcukhshsok/sql/new" target="_blank">SQL Editor ì—´ê¸°</a><br>
                                2. database-functions.sql ë‚´ìš© ë³µì‚¬ í›„ ì‹¤í–‰
                            </div>
                        `;
                    }
                }
            } catch (error) {
                statusEl.innerHTML = `<p>RPC Functions: <span class="status error">ì‹¤íŒ¨</span></p>`;
                log(`RPC ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        async function loadProducts() {
            const listEl = document.getElementById('products-list');
            listEl.innerHTML = '<p>ìƒí’ˆ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
            
            try {
                log('ìƒí’ˆ ëª©ë¡ ì¡°íšŒ ì¤‘...', 'info');
                const response = await fetch(`${SUPABASE_URL}/rest/v1/rpc/get_products`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        limit_count: 10,
                        offset_count: 0,
                        search_query: '',
                        category_filter: ''
                    })
                });
                
                const result = await response.json();
                
                if (response.ok && result.data) {
                    const products = result.data;
                    log(`${products.length}ê°œ ìƒí’ˆ ì¡°íšŒ ì„±ê³µ`, 'success');
                    
                    if (products.length === 0) {
                        listEl.innerHTML = `
                            <p class="status info">ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤. ìƒ˜í”Œ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.</p>
                            <button onclick="addSampleProduct()">ìƒ˜í”Œ ìƒí’ˆ ì¶”ê°€</button>
                        `;
                    } else {
                        let html = '<h3>ìƒí’ˆ ëª©ë¡</h3><ul>';
                        products.forEach(p => {
                            html += `<li>${p.name} - ${p.price}ì› (ì¬ê³ : ${p.stock})</li>`;
                        });
                        html += '</ul>';
                        listEl.innerHTML = html;
                    }
                } else {
                    listEl.innerHTML = '<p class="status error">ìƒí’ˆ ì¡°íšŒ ì‹¤íŒ¨</p>';
                    log('ìƒí’ˆ ì¡°íšŒ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                listEl.innerHTML = `<p class="status error">ì˜¤ë¥˜: ${error.message}</p>`;
                log(`ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        async function addSampleProduct() {
            try {
                log('ìƒ˜í”Œ ìƒí’ˆ ì¶”ê°€ ì¤‘...', 'info');
                const response = await fetch(`${SUPABASE_URL}/rest/v1/rpc/add_product`, {
                    method: 'POST',
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        product_name: 'í…ŒìŠ¤íŠ¸ ìƒí’ˆ ' + Date.now(),
                        product_price: 10000,
                        product_description: 'í…ŒìŠ¤íŠ¸ ì„¤ëª…',
                        product_category: 'ê¸°íƒ€',
                        product_stock: 10
                    })
                });
                
                if (response.ok) {
                    log('ìƒ˜í”Œ ìƒí’ˆ ì¶”ê°€ ì„±ê³µ!', 'success');
                    loadProducts();
                } else {
                    log('ìƒ˜í”Œ ìƒí’ˆ ì¶”ê°€ ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                log(`ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.onload = () => {
            log('ì§„ë‹¨ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'success');
            log('ì„œë²„ ë° API í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”', 'info');
        };
    </script>
</body>
</html>